{"version":3,"file":"openlogin.esm.js","sources":["../src/errors.ts","../src/logger.ts","../src/utils.ts","../src/PopupHandler.ts","../src/OpenLogin.ts"],"sourcesContent":["import { CustomError } from \"ts-custom-error\";\n\nexport interface IOpenloginError extends CustomError {\n  code: number;\n  message: string;\n  toString(): string;\n}\n\nexport type ErrorCodes = {\n  [key: number]: string;\n};\n\nexport abstract class OpenloginError extends CustomError implements IOpenloginError {\n  code: number;\n\n  message: string;\n\n  public constructor(code: number, message?: string) {\n    // takes care of stack and proto\n    super(message);\n\n    this.code = code;\n    this.message = message || \"\";\n    // Set name explicitly as minification can mangle class names\n    Object.defineProperty(this, \"name\", { value: \"OpenloginError\" });\n  }\n\n  toJSON(): IOpenloginError {\n    return {\n      name: this.name,\n      code: this.code,\n      message: this.message,\n    };\n  }\n\n  toString(): string {\n    return JSON.stringify(this.toJSON());\n  }\n}\n\nexport class InitializationError extends OpenloginError {\n  protected static messages: ErrorCodes = {\n    5000: \"Custom\",\n    5001: \"Invalid constructor params\",\n    5002: \"SDK not initialized. please call init first\",\n  };\n\n  public constructor(code: number, message?: string) {\n    // takes care of stack and proto\n    super(code, message);\n\n    // Set name explicitly as minification can mangle class names\n    Object.defineProperty(this, \"name\", { value: \"InitializationError\" });\n  }\n\n  public static fromCode(code: number, extraMessage = \"\"): OpenloginError {\n    return new InitializationError(code, `${InitializationError.messages[code]}, ${extraMessage}`);\n  }\n\n  public static invalidParams(extraMessage = \"\"): OpenloginError {\n    return InitializationError.fromCode(5001, extraMessage);\n  }\n\n  public static notInitialized(extraMessage = \"\"): OpenloginError {\n    return InitializationError.fromCode(5002, extraMessage);\n  }\n}\n\n/**\n * login errors\n */\n\nexport class LoginError extends OpenloginError {\n  protected static messages: ErrorCodes = {\n    5000: \"Custom\",\n    5111: \"Invalid login params\",\n    5112: \"User not logged in.\",\n    5113: \"login popup has been closed by the user\",\n    5114: \"Login failed\",\n  };\n\n  public constructor(code: number, message?: string) {\n    // takes care of stack and proto\n    super(code, message);\n\n    // Set name explicitly as minification can mangle class names\n    Object.defineProperty(this, \"name\", { value: \"LoginError\" });\n  }\n\n  public static fromCode(code: number, extraMessage = \"\"): OpenloginError {\n    return new LoginError(code, `${LoginError.messages[code]}, ${extraMessage}`);\n  }\n\n  public static invalidLoginParams(extraMessage = \"\"): OpenloginError {\n    return LoginError.fromCode(5111, extraMessage);\n  }\n\n  public static userNotLoggedIn(extraMessage = \"\"): OpenloginError {\n    return LoginError.fromCode(5112, extraMessage);\n  }\n\n  public static popupClosed(extraMessage = \"\"): OpenloginError {\n    return LoginError.fromCode(5113, extraMessage);\n  }\n\n  public static loginFailed(extraMessage = \"\"): OpenloginError {\n    return LoginError.fromCode(5114, extraMessage);\n  }\n}\n","import { getLogger } from \"loglevel\";\n\nexport const loglevel = getLogger(\"openlogin\");\n\nloglevel.setLevel(\"error\");\n","import { getPublic, sign } from \"@toruslabs/eccrypto\";\nimport { keccak256 } from \"@toruslabs/metadata-helpers\";\nimport { base64url, LOGIN_PROVIDER, safeatob, safebtoa } from \"@toruslabs/openlogin-utils\";\nimport bowser from \"bowser\";\n\nimport { loglevel as log } from \"./logger\";\n\n// don't use destructuring for process.env cause it messes up webpack env plugin\nexport const version = process.env.OPENLOGIN_VERSION;\n\nexport async function whitelistUrl(clientId: string, appKey: string, origin: string): Promise<string> {\n  const appKeyBuf = Buffer.from(appKey.padStart(64, \"0\"), \"hex\");\n  if (base64url.encode(getPublic(appKeyBuf)) !== clientId) throw new Error(\"appKey mismatch\");\n  const sig = await sign(appKeyBuf, keccak256(Buffer.from(origin, \"utf8\")));\n  return base64url.encode(sig);\n}\n\nexport type HashQueryParamResult = {\n  sessionId?: string;\n  sessionNamespace?: string;\n  error?: string;\n};\n\nexport function getHashQueryParams(replaceUrl = false): HashQueryParamResult {\n  const result: HashQueryParamResult = {};\n\n  const url = new URL(window.location.href);\n  url.searchParams.forEach((value: string, key: string) => {\n    if (key !== \"result\") {\n      result[key as keyof HashQueryParamResult] = value;\n    }\n  });\n  const queryResult = url.searchParams.get(\"result\");\n  if (queryResult) {\n    try {\n      const queryParams = JSON.parse(safeatob(queryResult));\n      Object.keys(queryParams).forEach((key: string) => {\n        result[key as keyof HashQueryParamResult] = queryParams[key];\n      });\n    } catch (error) {\n      log.error(error);\n    }\n  }\n\n  const hash = url.hash.substring(1);\n  const hashUrl = new URL(`${window.location.origin}/?${hash}`);\n  hashUrl.searchParams.forEach((value: string, key: string) => {\n    if (key !== \"result\") {\n      result[key as keyof HashQueryParamResult] = value;\n    }\n  });\n  const hashResult = hashUrl.searchParams.get(\"result\");\n\n  if (hashResult) {\n    try {\n      const hashParams = JSON.parse(safeatob(hashResult));\n      Object.keys(hashParams).forEach((key: string) => {\n        result[key as keyof HashQueryParamResult] = hashParams[key];\n      });\n    } catch (error) {\n      log.error(error);\n    }\n  }\n\n  if (replaceUrl) {\n    const cleanUrl = new URL(window.location.origin + window.location.pathname);\n    cleanUrl.search = window.location.search;\n    if (hashResult) {\n      const hashParams = JSON.parse(safeatob(hashResult));\n      delete hashParams.sessionId;\n      delete hashParams.sessionNamespace;\n      delete hashParams.error;\n      cleanUrl.hash = safebtoa(JSON.stringify(hashParams));\n    }\n    window.history.replaceState({ ...window.history.state, as: cleanUrl.href, url: cleanUrl.href }, \"\", cleanUrl.href);\n  }\n\n  return result;\n}\n\nexport function constructURL(params: { baseURL: string; query?: Record<string, unknown>; hash?: Record<string, unknown> }): string {\n  const { baseURL, query, hash } = params;\n\n  const url = new URL(baseURL);\n  if (query) {\n    Object.keys(query).forEach((key) => {\n      url.searchParams.append(key, query[key] as string);\n    });\n  }\n  if (hash) {\n    const h = new URL(constructURL({ baseURL, query: hash })).searchParams.toString();\n    url.hash = h;\n  }\n  return url.toString();\n}\n\nexport function getPopupFeatures(): string {\n  if (typeof window === \"undefined\") return \"\";\n  // Fixes dual-screen position                             Most browsers      Firefox\n  const dualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : window.screenX;\n  const dualScreenTop = window.screenTop !== undefined ? window.screenTop : window.screenY;\n\n  const w = 1200;\n  const h = 700;\n\n  const width = window.innerWidth\n    ? window.innerWidth\n    : document.documentElement.clientWidth\n    ? document.documentElement.clientWidth\n    : window.screen.width;\n\n  const height = window.innerHeight\n    ? window.innerHeight\n    : document.documentElement.clientHeight\n    ? document.documentElement.clientHeight\n    : window.screen.height;\n\n  const systemZoom = 1; // No reliable estimate\n\n  const left = Math.abs((width - w) / 2 / systemZoom + dualScreenLeft);\n  const top = Math.abs((height - h) / 2 / systemZoom + dualScreenTop);\n  const features = `titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=${h / systemZoom},width=${w / systemZoom},top=${top},left=${left}`;\n  return features;\n}\n\nexport function isMobileOrTablet(): boolean {\n  if (typeof window === \"undefined\") return false;\n  const browser = bowser.getParser(window.navigator.userAgent);\n  const platform = browser.getPlatform();\n  return platform.type === bowser.PLATFORMS_MAP.tablet || platform.type === bowser.PLATFORMS_MAP.mobile;\n}\n\nexport function getTimeout(loginProvider: string) {\n  if ((loginProvider === LOGIN_PROVIDER.FACEBOOK || loginProvider === LOGIN_PROVIDER.LINE) && isMobileOrTablet()) {\n    return 1000 * 60 * 5; // 5 minutes to finish the login\n  }\n  return 1000 * 10; // 10 seconds\n}\n","import { BroadcastChannel } from \"@toruslabs/broadcast-channel\";\nimport { EventEmitter } from \"events\";\n\nimport { getPopupFeatures } from \"./utils\";\n\nexport interface PopupResponse {\n  sessionId?: string;\n  sessionNamespace?: string;\n}\nclass PopupHandler extends EventEmitter {\n  url: string;\n\n  target: string;\n\n  features: string;\n\n  window: Window;\n\n  windowTimer: number;\n\n  iClosedWindow: boolean;\n\n  timeout: number;\n\n  constructor({ url, target, features, timeout = 30000 }: { url: string; target?: string; features?: string; timeout?: number }) {\n    super();\n    this.url = url;\n    this.target = target || \"_blank\";\n    this.features = features || getPopupFeatures();\n    this.window = undefined;\n    this.windowTimer = undefined;\n    this.iClosedWindow = false;\n    this.timeout = timeout;\n    this._setupTimer();\n  }\n\n  _setupTimer(): void {\n    this.windowTimer = Number(\n      setInterval(() => {\n        if (this.window && this.window.closed) {\n          clearInterval(this.windowTimer);\n          setTimeout(() => {\n            if (!this.iClosedWindow) {\n              this.emit(\"close\");\n            }\n            this.iClosedWindow = false;\n            this.window = undefined;\n          }, this.timeout);\n        }\n        if (this.window === undefined) clearInterval(this.windowTimer);\n      }, 500)\n    );\n  }\n\n  open(): void {\n    this.window = window.open(this.url, this.target, this.features);\n    if (this.window?.focus) this.window.focus();\n  }\n\n  close(): void {\n    this.iClosedWindow = true;\n    if (this.window) this.window.close();\n  }\n\n  redirect(locationReplaceOnRedirect: boolean): void {\n    if (locationReplaceOnRedirect) {\n      window.location.replace(this.url);\n    } else {\n      window.location.href = this.url;\n    }\n  }\n\n  async listenOnChannel(loginId: string): Promise<PopupResponse> {\n    return new Promise<PopupResponse>((resolve, reject) => {\n      const bc = new BroadcastChannel<{ error?: string; data?: PopupResponse }>(loginId, {\n        webWorkerSupport: false,\n        type: \"server\",\n      });\n      bc.addEventListener(\"message\", (ev) => {\n        this.close();\n        bc.close();\n        if (ev.error) {\n          reject(new Error(ev.error));\n        } else {\n          resolve(ev.data);\n        }\n      });\n    });\n  }\n}\n\nexport default PopupHandler;\n","import { OpenloginSessionManager } from \"@toruslabs/openlogin-session-manager\";\nimport {\n  BaseLoginParams,\n  BaseRedirectParams,\n  BrowserStorage,\n  BUILD_ENV,\n  jsonToBase64,\n  LoginParams,\n  OPENLOGIN_ACTIONS,\n  OPENLOGIN_NETWORK,\n  OpenLoginOptions,\n  OpenloginSessionConfig,\n  OpenloginSessionData,\n  OpenloginUserInfo,\n  SocialMfaModParams,\n  UX_MODE,\n} from \"@toruslabs/openlogin-utils\";\n\nimport { InitializationError, LoginError } from \"./errors\";\nimport { loglevel as log } from \"./logger\";\nimport PopupHandler, { PopupResponse } from \"./PopupHandler\";\nimport { constructURL, getHashQueryParams, getTimeout, version } from \"./utils\";\n\nclass OpenLogin {\n  state: OpenloginSessionData = {};\n\n  options: OpenLoginOptions;\n\n  private sessionManager: OpenloginSessionManager<OpenloginSessionData>;\n\n  private currentStorage: BrowserStorage;\n\n  private _storageBaseKey = \"openlogin_store\";\n\n  constructor(options: OpenLoginOptions) {\n    if (!options.clientId) throw InitializationError.invalidParams(\"clientId is required\");\n    if (!options.network) options.network = OPENLOGIN_NETWORK.SAPPHIRE_MAINNET;\n    if (!options.buildEnv) options.buildEnv = BUILD_ENV.PRODUCTION;\n    if (!options.sdkUrl) {\n      if (options.buildEnv === BUILD_ENV.DEVELOPMENT) {\n        options.sdkUrl = \"http://localhost:3000\";\n      } else if (options.buildEnv === BUILD_ENV.STAGING) {\n        options.sdkUrl = \"https://staging-auth.web3auth.io\";\n      } else if (options.buildEnv === BUILD_ENV.TESTING) {\n        options.sdkUrl = \"https://develop-auth.web3auth.io\";\n      } else {\n        options.sdkUrl = \"https://auth.web3auth.io\";\n      }\n    }\n\n    if (!options.redirectUrl && typeof window !== \"undefined\") {\n      options.redirectUrl = `${window.location.protocol}//${window.location.host}${window.location.pathname}`;\n    }\n    if (!options.uxMode) options.uxMode = UX_MODE.REDIRECT;\n    if (typeof options.replaceUrlOnRedirect !== \"boolean\") options.replaceUrlOnRedirect = true;\n    if (!options.originData) options.originData = {};\n    if (!options.whiteLabel) options.whiteLabel = {};\n    if (!options.loginConfig) options.loginConfig = {};\n    if (!options.mfaSettings) options.mfaSettings = {};\n    if (!options.storageServerUrl) options.storageServerUrl = \"https://broadcast-server.tor.us\";\n    if (!options.storageKey) options.storageKey = \"local\";\n    if (!options.webauthnTransports) options.webauthnTransports = [\"internal\"];\n    if (!options.sessionTime) options.sessionTime = 86400;\n\n    this.options = options;\n  }\n\n  get privKey(): string {\n    return this.state.privKey ? this.state.privKey.padStart(64, \"0\") : \"\";\n  }\n\n  get coreKitKey(): string {\n    return this.state.coreKitKey ? this.state.coreKitKey.padStart(64, \"0\") : \"\";\n  }\n\n  get ed25519PrivKey(): string {\n    return this.state.ed25519PrivKey ? this.state.ed25519PrivKey.padStart(128, \"0\") : \"\";\n  }\n\n  get coreKitEd25519Key(): string {\n    return this.state.coreKitEd25519PrivKey ? this.state.coreKitEd25519PrivKey.padStart(128, \"0\") : \"\";\n  }\n\n  get sessionId(): string {\n    return this.state.sessionId || \"\";\n  }\n\n  get sessionNamespace(): string {\n    return this.options.sessionNamespace || \"\";\n  }\n\n  private get baseUrl(): string {\n    // testing and develop don't have versioning\n    if (this.options.buildEnv === BUILD_ENV.DEVELOPMENT || this.options.buildEnv === BUILD_ENV.TESTING) return `${this.options.sdkUrl}`;\n    return `${this.options.sdkUrl}/v${version.split(\".\")[0]}`;\n  }\n\n  async init(): Promise<void> {\n    // get sessionNamespace from the redirect result.\n    const params = getHashQueryParams(this.options.replaceUrlOnRedirect);\n    if (params.sessionNamespace) this.options.sessionNamespace = params.sessionNamespace;\n\n    const storageKey = this.options.sessionNamespace ? `${this._storageBaseKey}_${this.options.sessionNamespace}` : this._storageBaseKey;\n    this.currentStorage = BrowserStorage.getInstance(storageKey, this.options.storageKey);\n\n    const sessionId = this.currentStorage.get<string>(\"sessionId\");\n\n    this.sessionManager = new OpenloginSessionManager({\n      sessionServerBaseUrl: this.options.storageServerUrl,\n      sessionNamespace: this.options.sessionNamespace,\n      sessionTime: this.options.sessionTime,\n      sessionId,\n    });\n\n    if (this.options.network === OPENLOGIN_NETWORK.TESTNET || this.options.network === OPENLOGIN_NETWORK.SAPPHIRE_DEVNET) {\n      // using console log because it shouldn't be affected by loglevel config\n      // eslint-disable-next-line no-console\n      console.log(\n        `%c WARNING! You are on ${this.options.network}. Please set network: 'mainnet' or 'sapphire_mainnet' in production`,\n        \"color: #FF0000\"\n      );\n    }\n\n    if (this.options.buildEnv !== BUILD_ENV.PRODUCTION) {\n      // using console log because it shouldn't be affected by loglevel config\n      // eslint-disable-next-line no-console\n      console.log(`%c WARNING! You are using build env ${this.options.buildEnv}. Please set buildEnv: 'production' in production`, \"color: #FF0000\");\n    }\n\n    if (params.error) {\n      throw LoginError.loginFailed(params.error);\n    }\n\n    if (params.sessionId) {\n      this.currentStorage.set(\"sessionId\", params.sessionId);\n      this.sessionManager.sessionId = params.sessionId;\n    }\n\n    if (this.sessionManager.sessionId) {\n      const data = await this._authorizeSession();\n      // Fill state with correct info from session\n      // If session is invalid all the data is unset here.\n      this.updateState(data);\n      if (Object.keys(data).length === 0) {\n        // If session is invalid, unset the sessionId from localStorage.\n        this.currentStorage.set(\"sessionId\", \"\");\n      }\n    }\n  }\n\n  async login(params: LoginParams & Partial<BaseRedirectParams>): Promise<{ privKey: string }> {\n    if (!params.loginProvider) throw LoginError.invalidLoginParams(`loginProvider is required`);\n\n    // in case of redirect mode, redirect url will be dapp specified\n    // in case of popup mode, redirect url will be sdk specified\n    const defaultParams: BaseRedirectParams = {\n      redirectUrl: this.options.redirectUrl,\n    };\n\n    const loginParams: LoginParams = {\n      loginProvider: params.loginProvider,\n      ...defaultParams,\n      ...params,\n    };\n\n    const dataObject: OpenloginSessionConfig = {\n      actionType: OPENLOGIN_ACTIONS.LOGIN,\n      options: this.options,\n      params: loginParams,\n    };\n\n    const result = await this.openloginHandler(`${this.baseUrl}/start`, dataObject, getTimeout(params.loginProvider));\n    if (this.options.uxMode === UX_MODE.REDIRECT) return undefined;\n    this.sessionManager.sessionId = result.sessionId;\n    this.options.sessionNamespace = result.sessionNamespace;\n    this.currentStorage.set(\"sessionId\", result.sessionId);\n    await this.rehydrateSession();\n    return { privKey: this.privKey };\n  }\n\n  async logout(): Promise<void> {\n    if (!this.sessionManager.sessionId) throw LoginError.userNotLoggedIn();\n    await this.sessionManager.invalidateSession();\n    this.updateState({\n      privKey: \"\",\n      coreKitKey: \"\",\n      coreKitEd25519PrivKey: \"\",\n      ed25519PrivKey: \"\",\n      walletKey: \"\",\n      oAuthPrivateKey: \"\",\n      tKey: \"\",\n      metadataNonce: \"\",\n      keyMode: undefined,\n      userInfo: {\n        name: \"\",\n        profileImage: \"\",\n        dappShare: \"\",\n        idToken: \"\",\n        oAuthIdToken: \"\",\n        oAuthAccessToken: \"\",\n        appState: \"\",\n        email: \"\",\n        verifier: \"\",\n        verifierId: \"\",\n        aggregateVerifier: \"\",\n        typeOfLogin: \"\",\n        isMfaEnabled: false,\n      },\n      authToken: \"\",\n    });\n\n    this.currentStorage.set(\"sessionId\", \"\");\n  }\n\n  async setupMFA(params: Partial<BaseRedirectParams>): Promise<boolean> {\n    if (!this.sessionId) throw LoginError.userNotLoggedIn();\n\n    // in case of redirect mode, redirect url will be dapp specified\n    // in case of popup mode, redirect url will be sdk specified\n    const defaultParams: BaseRedirectParams = {\n      redirectUrl: this.options.redirectUrl,\n    };\n\n    const dataObject: OpenloginSessionConfig = {\n      actionType: OPENLOGIN_ACTIONS.ENABLE_MFA,\n      options: this.options,\n      params: {\n        ...defaultParams,\n        ...params,\n      },\n      sessionId: this.sessionId,\n    };\n\n    const result = await this.openloginHandler(`${this.baseUrl}/start`, dataObject);\n    if (this.options.uxMode === UX_MODE.REDIRECT) return undefined;\n    this.sessionManager.sessionId = result.sessionId;\n    this.options.sessionNamespace = result.sessionNamespace;\n    this.currentStorage.set(\"sessionId\", result.sessionId);\n    await this.rehydrateSession();\n    return true;\n  }\n\n  async changeSocialFactor(params: SocialMfaModParams & Partial<BaseRedirectParams>): Promise<boolean> {\n    if (!this.sessionId) throw LoginError.userNotLoggedIn();\n\n    // in case of redirect mode, redirect url will be dapp specified\n    // in case of popup mode, redirect url will be sdk specified\n    const defaultParams: BaseRedirectParams = {\n      redirectUrl: this.options.redirectUrl,\n    };\n\n    const dataObject: OpenloginSessionConfig = {\n      actionType: OPENLOGIN_ACTIONS.MODIFY_MFA,\n      options: this.options,\n      params: {\n        ...defaultParams,\n        ...params,\n      },\n      sessionId: this.sessionId,\n    };\n\n    const result = await this.openloginHandler(`${this.baseUrl}/start`, dataObject);\n    if (this.options.uxMode === UX_MODE.REDIRECT) return undefined;\n    this.sessionManager.sessionId = result.sessionId;\n    this.options.sessionNamespace = result.sessionNamespace;\n    this.currentStorage.set(\"sessionId\", result.sessionId);\n    await this.rehydrateSession();\n    return true;\n  }\n\n  getUserInfo(): OpenloginUserInfo {\n    if (!this.sessionManager.sessionId) {\n      throw LoginError.userNotLoggedIn();\n    }\n    return this.state.userInfo;\n  }\n\n  async getLoginId(data: OpenloginSessionConfig): Promise<string> {\n    if (!this.sessionManager) throw InitializationError.notInitialized();\n\n    const loginId = OpenloginSessionManager.generateRandomSessionKey();\n    const loginSessionMgr = new OpenloginSessionManager<OpenloginSessionConfig>({\n      sessionServerBaseUrl: this.options.storageServerUrl,\n      sessionNamespace: this.options.sessionNamespace,\n      sessionTime: 600, // each login key must be used with 10 mins (might be used at the end of popup redirect)\n      sessionId: loginId,\n    });\n\n    await loginSessionMgr.createSession(JSON.parse(JSON.stringify(data)));\n\n    return loginId;\n  }\n\n  private async _authorizeSession(): Promise<OpenloginSessionData> {\n    try {\n      if (!this.sessionManager.sessionId) return {};\n      const result = await this.sessionManager.authorizeSession();\n      return result;\n    } catch (err) {\n      log.error(\"authorization failed\", err);\n      return {};\n    }\n  }\n\n  private updateState(data: Partial<OpenloginSessionData>) {\n    this.state = { ...this.state, ...data };\n  }\n\n  private async rehydrateSession(): Promise<void> {\n    const result = await this._authorizeSession();\n    this.updateState(result);\n  }\n\n  private async openloginHandler(url: string, dataObject: OpenloginSessionConfig, popupTimeout = 1000 * 10): Promise<PopupResponse | undefined> {\n    const loginId = await this.getLoginId(dataObject);\n    const configParams: BaseLoginParams = {\n      loginId,\n      sessionNamespace: this.options.sessionNamespace,\n    };\n\n    if (this.options.uxMode === UX_MODE.REDIRECT) {\n      const loginUrl = constructURL({\n        baseURL: url,\n        hash: { b64Params: jsonToBase64(configParams) },\n      });\n      window.location.href = loginUrl;\n      return undefined;\n    }\n    return new Promise((resolve, reject) => {\n      const loginUrl = constructURL({\n        baseURL: url,\n        hash: { b64Params: jsonToBase64(configParams) },\n      });\n      const currentWindow = new PopupHandler({ url: loginUrl, timeout: popupTimeout });\n\n      currentWindow.on(\"close\", () => {\n        reject(LoginError.popupClosed());\n      });\n\n      currentWindow.listenOnChannel(loginId).then(resolve).catch(reject);\n\n      currentWindow.open();\n    });\n  }\n}\n\nexport default OpenLogin;\n"],"names":["OpenloginError","CustomError","constructor","code","message","_defineProperty","Object","defineProperty","value","toJSON","name","toString","JSON","stringify","InitializationError","fromCode","extraMessage","arguments","length","undefined","messages","invalidParams","notInitialized","LoginError","invalidLoginParams","userNotLoggedIn","popupClosed","loginFailed","loglevel","getLogger","setLevel","version","whitelistUrl","clientId","appKey","origin","appKeyBuf","Buffer","from","padStart","base64url","encode","getPublic","Error","sig","sign","keccak256","getHashQueryParams","replaceUrl","result","url","URL","window","location","href","searchParams","forEach","key","queryResult","get","queryParams","parse","safeatob","keys","error","log","hash","substring","hashUrl","hashResult","hashParams","cleanUrl","pathname","search","sessionId","sessionNamespace","safebtoa","history","replaceState","_objectSpread","state","as","constructURL","params","baseURL","query","append","h","getPopupFeatures","dualScreenLeft","screenLeft","screenX","dualScreenTop","screenTop","screenY","w","width","innerWidth","document","documentElement","clientWidth","screen","height","innerHeight","clientHeight","systemZoom","left","Math","abs","top","features","isMobileOrTablet","browser","bowser","getParser","navigator","userAgent","platform","getPlatform","type","PLATFORMS_MAP","tablet","mobile","getTimeout","loginProvider","LOGIN_PROVIDER","FACEBOOK","LINE","PopupHandler","EventEmitter","_ref","target","timeout","windowTimer","iClosedWindow","_setupTimer","Number","setInterval","closed","clearInterval","setTimeout","emit","open","_this$window","focus","close","redirect","locationReplaceOnRedirect","replace","listenOnChannel","loginId","Promise","resolve","reject","bc","BroadcastChannel","webWorkerSupport","addEventListener","ev","data","OpenLogin","options","network","OPENLOGIN_NETWORK","SAPPHIRE_MAINNET","buildEnv","BUILD_ENV","PRODUCTION","sdkUrl","DEVELOPMENT","STAGING","TESTING","redirectUrl","protocol","host","uxMode","UX_MODE","REDIRECT","replaceUrlOnRedirect","originData","whiteLabel","loginConfig","mfaSettings","storageServerUrl","storageKey","webauthnTransports","sessionTime","privKey","coreKitKey","ed25519PrivKey","coreKitEd25519Key","coreKitEd25519PrivKey","baseUrl","split","init","_storageBaseKey","currentStorage","BrowserStorage","getInstance","sessionManager","OpenloginSessionManager","sessionServerBaseUrl","TESTNET","SAPPHIRE_DEVNET","console","set","_authorizeSession","updateState","login","defaultParams","loginParams","dataObject","actionType","OPENLOGIN_ACTIONS","LOGIN","openloginHandler","rehydrateSession","logout","invalidateSession","walletKey","oAuthPrivateKey","tKey","metadataNonce","keyMode","userInfo","profileImage","dappShare","idToken","oAuthIdToken","oAuthAccessToken","appState","email","verifier","verifierId","aggregateVerifier","typeOfLogin","isMfaEnabled","authToken","setupMFA","ENABLE_MFA","changeSocialFactor","MODIFY_MFA","getUserInfo","getLoginId","generateRandomSessionKey","loginSessionMgr","createSession","authorizeSession","err","popupTimeout","configParams","loginUrl","b64Params","jsonToBase64","currentWindow","on","then","catch"],"mappings":"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"}